user                www-data;
worker_processes    auto;
worker_rlimit_nofile 100000;

error_log           /var/log/nginx/error.log warn;
pid                 /var/run/nginx.pid;

events {
    worker_connections  2000;
    multi_accept on;
    use epoll;
}

http {
    include           /etc/nginx/mime.types;
    default_type      application/octet-stream;

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log        /var/log/nginx/access.log  main;
    error_log         /var/log/nginx/error.log  warn;

    # do not show the nginx version
    server_tokens   off;

    keepalive_timeout   65;
    autoindex		    off;
    port_in_redirect	off;
    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    client_max_body_size 64m;

    ## Flood protection example
    limit_req_zone $binary_remote_addr zone=goeasy:25m rate=1r/s;

    ## Cache open FD
    open_file_cache max=10000 inactive=3600s;
    open_file_cache_valid 7200s;
    open_file_cache_min_uses 2;

    ## Gzipping is an easy way to reduce page weight
    gzip                on;
    gzip_vary           on;
    gzip_proxied        any;
    gzip_disable        "MSIE [1-6]\.(?!.*SV1)";
    gzip_types          application/javascript application/x-javascript text/javascript text/plain text/xml text/css;
    gzip_buffers        16 8k;
    gzip_comp_level     6;

    charset utf-8;
    charset_types *;

    ## Map status to exclude from access log
    map $status $writelog { 404  0; 410  0; 444  0; default 1; }

    include /etc/nginx/conf.d/*.conf;

    ##SSL Settings
    ssl_ciphers "AES128+EECDH:AES128+EDH";
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains";
    ssl_stapling on;
    ssl_stapling_verify on;
}


daemon off;